---
title: "步骤六：更新审批数据"
source_url: https://open.feishu.cn/document/quickly-develop-three-party-approvals/send-and-update-approval-bot-messages
last_remote_update: 2024-02-18
last_remote_update_timestamp: 1708241712000
---
最后更新于 2024-02-18

# 步骤六：更新审批数据

当审批人在飞书客户端内完成审批操作时，会向三方审批系统的回调地址发送请求数据。三方审批系统在接收到回调数据后，需要进行审批业务逻辑处理，并调用[更新审批 Bot 消息](https://open.feishu.cn/document/ukTMukTMukTM/uAjNyYjLwYjM24CM2IjN)接口，将更新后的审批消息通过机器人推送至审批人，此外还需要调用[同步三方审批实例](https://open.feishu.cn/document/uAjLw4CM/ukTMukTMukTM/reference/approval-v4/external_instance/create)接口，更新在飞书审批中心内的审批实例与任务状态。

## 操作步骤

1. 使用`curl`命令行工具调用`更新审批 Bot 消息`接口，向审批人发送审批结果通知消息。

```Bash
    curl --location --request POST 'https://www.feishu.cn/approval/openapi/v1/message/update' \
    --header 'Authorization: Bearer t-g1046tgkRWD2CRJSHO4W4BCBWULQM2JQSBPM2xxx' \
    --header 'Content-Type: application/json; charset=utf-8' \
    --data-raw '{"message_id":"7250020197497765889","status":"APPROVED"}'
    ```

配置说明：

- 在 curl 命令行中，需要配置接口的请求方式（POST），以及请求 URL（`https://www.feishu.cn/approval/openapi/v1/message/update`）。

- 在`--header`变量中，需要为 **Authorization** 字段配置应用访问凭证 tenant_access_token，格式为`Bearer t-xxxx`。

你可以参考[步骤二：获取访问凭证](https://open.feishu.cn/document/home/quickly-develop-three-party-approvals/creating-applications-and-requesting-permissions)，获取 tenant_access_token。

- 在`--data-raw`变量中，配置请求体。

- **message_id**：填写发送审批 bot 消息时，回显结果中得到的`message_id`值。

- **status**：审批状态。示例值`APPROVED`表示已同意。
2. 在审批人的飞书客户端中，查看更新审批 bot 消息。

![](https://sf3-cn.feishucdn.com/obj/open-platform-opendoc/24a24c75aef9beb30f0cbc3c7958b95c_mpmrCbZhjH.png?height=1506&lazyload=true&maxWidth=600&width=1976)

3. 登录 [API 调试台](https://open.feishu.cn/api-explorer)。

4. 在左侧 **API 列表** 中，选择 **审批** > **三方审批实例** > **同步三方审批实例**。

5. 完成以下参数配置，并点击 **开始调试**。

- **请求头**：**Authorization** 字段以默认配置了应用访问凭证 **tenant_access_token**。

- **请求体**：示例配置以及参数说明请参见以下JSON 示例代码。

注意事项：

- 你可以点击 **请求体** 内的 **恢复示例值**，查看系统提供的示例请求体。
        - 在实际使用以下 JSON 示例代码时，需要注意将`//`开头的注释文字去掉后再使用。
        - 关于接口完整参数的配置说明，参见[同步三方审批实例](https://open.feishu.cn/document/uAjLw4CM/ukTMukTMukTM/reference/approval-v4/external_instance/create)。
        - 示例配置仍然保持步骤四：同步三方审批数据内的数据，仅修改审批实例、审批任务的状态（`status`）为已同意（`APPROVED`）。

```JSON
        {
          "approval_code": "9D706BA5-9E9F-416E-96CB-53FEF8B9xxxx",
          "instance_id": "3162634",
          "status": "APPROVED", // 状态需要更新为 APPROVED 已同意。
          "links": {
            "pc_link": "http://applink.feishu.cn/sso/common?xxx",
            "mobile_link": "http://applink.feishu.cn/sso/common?xxx"
          },
          "title": "@i18n@1",
          "form": [
            {
              "name": "@i18n@2",
              "value": "@i18n@3"
            }
          ],
          "user_id": "454dg7x4",
          "user_name": "李健",
          "start_time": "1688022000000",
          "update_time": "1688022600000",
          "end_time": 0,
          "update_mode": "REPLACE",
          "task_list": [
            {
              "task_id": "112253",
              "user_id": "454dg7x4",
              "links": {
                "pc_link": "http://www.example.com",
                "mobile_link": "http://www.example.com"
              },
              "status": "APPROVED", // 状态需要更新为 APPROVED 已同意。
              "title": "同意审批",
              "create_time": "1688022000000",
              "end_time": 0,
              "update_time": "1688022600000",
              "action_context": "123456",
              "action_configs": [
                {
                  "action_type": "APPROVE",
                  "action_name": "@i18n@1",
                  "is_need_reason": true,
                  "is_reason_required": true,
                  "is_need_attachment": true
                }
              ]
            }
          ],
          "cc_list": [
            {
              "cc_id": "1231243",
              "user_id": "454dg7x4",
              "links": {
                "pc_link": "http://www.example.com",
                "mobile_link": "http://www.example.com"
              },
              "read_status": "READ",
              "title": "抄送任务",
              "create_time": "1688022000000",
              "update_time": "1688022600000"
            }
          ],
          "i18n_resources": [
            {
              "locale": "zh-CN",
              "is_default": true,
              "texts": [
                {
                  "key": "@i18n@1",
                  "value": "测试审批"
                },
                {
                  "key": "@i18n@2",
                  "value": "天"
                },
                {
                  "key": "@i18n@3",
                  "value": "2023-06-29"
                }
              ]
            }
          ]
        }
        ```

调用成功的回显信息如下图所示。

![image.png](https://sf3-cn.feishucdn.com/obj/open-platform-opendoc/a382e520cb7d474690fabd0685223518_TdxsfZ61FH.png?height=1120&lazyload=true&maxWidth=600&width=2206)

使用审批人用户信息登录飞书客户端，在 **工作台** > **审批** > **审批中心**，在 **已办** 中，可以查看对应的审批任务状态已变更为 **已同意**。

![](https://sf3-cn.feishucdn.com/obj/open-platform-opendoc/b2ddc307567de00eee1f43bec542338e_RP2DR1ON8k.png?height=792&lazyload=true&maxWidth=600&width=1234)
