---
title: "示例代码说明"
source_url: https://open.feishu.cn/document/home/department-personnel-management-based-on-web-app/sample-code-description
last_remote_update: 2023-09-06
last_remote_update_timestamp: 1693995056000
---
最后更新于 2023-09-06

# 示例代码说明

在本教程提供的代码示例中，配置了免登流程的相关代码。
关于网页应用免登流程的详细操作说明，请参见[免登流程](https://open.feishu.cn/document/uYjL24iN/uMTMuMTMuMTM/development-guide/step-3)。

## 前端代码释义

1. 打开示例代码的 `/use-free-login.js` 文件。

文件路径为 `/web_app/src/client/use-free-login.js`。

2. 通过 window.h5sdk 判断是否在飞书内打开，是通过飞书打开后，继续免登流程。

3. 通过接口获取 App ID。

```JavaScript
   const appId = await fetch("/get_app_id").then((res) => res.text());
   ```

4. 通过 ready 接口（window.h5sdk.ready）确认环境准备就绪。

确认环境准备就绪后，才能调用 JSAPI。

```JavaScript
    window.h5sdk.ready(() => {}
    ```

5. 调用JSAPI `tt.requestAuthCode` 获取 code。

```JavaScript
   window.tt.requestAuthCode({
            appId,
            // 获取成功后的回调
            async success(res) {
              console.log("getAuthCode succeed");
               },
            // 获取失败后的回调
            fail(err) {
              console.log(`getAuthCode failed, err:`, JSON.stringify(err));
            },
          });
        });
   ```

6. 把 code 传递给服务端获取用户信息。

```JavaScript
   fetch(`/get_user_info?code=${res.code}`).then((res) => res.json());
   ```

## 服务端代码释义

1. 打开示例代码的 `/index.js` 文件。

文件路径为`web_app/src/server/index.js`。

2. 在上文前端代码释义的步骤 6 中，获取应用的 App ID 和 App Secret。

```JavaScript
    const client = new lark.Client({
      appId: APP_ID,
      appSecret: APP_SECRET,
    });
    ```

3. 获取 app_access_token。

```JavaScript
    const { app_access_token } = await client.request({
        url: "/open-apis/auth/v3/app_access_token/internal",
        method: "POST",
        params: {
          app_id: APP_ID,
          app_secret: APP_SECRET,
        },
      });
    ```

4. 获取用户信息时，需要 access_token。

```JavaScript
   const {
        data: { access_token },
      } = await client.request(
        {
          url: "/open-apis/authen/v1/access_token",
          method: "POST",
          data: {
            grant_type: "authorization_code",
            code,
          },
        },
        {
          headers: {
            Authorization: `Bearer ${app_access_token}`,
          },
        }
      );
   ```

5. 获取用户信息。

```JavaScript
    const { data } = await client.request(
        {
          url: "/open-apis/authen/v1/user_info",
          method: "GET",
        },
        lark.withUserAccessToken(access_token)
      );
    ```
