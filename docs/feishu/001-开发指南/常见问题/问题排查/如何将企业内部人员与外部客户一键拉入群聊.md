---
title: "如何将企业内部人员与外部客户一键拉入群聊"
source_url: https://open.feishu.cn/document/faq/trouble-shooting/add-internal-employees-and-external-clients-to-group
last_remote_update: 2024-12-09
last_remote_update_timestamp: 1733727985000
---
最后更新于 2024-12-09

# 如何将企业内部人员与外部客户一键拉入群聊

本文基于[机器人支持外部群和外部用户单聊](https://open.feishu.cn/document/uAjLw4CM/ukzMukzMukzM/develop-robots/add-bot-to-external-group)能力，介绍如何通过应用机器人将企业内部人员与外部客户拉入同一群组。

## 前提条件

- 企业必须完成[飞书认证](https://www.feishu.cn/hc/zh-CN/articles/360034114413-%E9%A3%9E%E4%B9%A6%E8%AE%A4%E8%AF%81%E4%BB%8B%E7%BB%8D)。

本文能力实现基于企业自建应用的对外共享，对外共享只有认证企业可以使用。

- 外部客户的飞书客户端版本需要在 V7.22 及以上。

使用机器人拉外部客户入群前，必须让客户与机器人发起单聊，该操作从飞书 V7.22 版本开始支持。

## 实现思路

1. 创建一个[企业自建应用](https://open.feishu.cn/document/home/introduction-to-custom-app-development/self-built-application-development-process#a0a7f6b0)。warning
   仅企业自建应用支持开启对外共享。商店应用暂不支持。

![](https://sf3-cn.feishucdn.com/obj/open-platform-opendoc/2a4a947d80f2a7c0734c7d56e238d594_VI0xXGznbh.png?height=460&lazyload=true&maxWidth=600&width=1836)

2. 在应用的 **应用能力 > 添加应用能力** 功能页，为应用[启用机器人能力](https://open.feishu.cn/document/uAjLw4CM/ugTN1YjL4UTN24CO1UjN/trouble-shooting/how-to-enable-bot-ability)。

![](https://sf3-cn.feishucdn.com/obj/open-platform-opendoc/882b9986ac04d27923deeb733fc85ead_dYa7Mpgs8L.png?height=670&lazyload=true&maxWidth=600&width=1618)

3. 在应用的 **开发配置 > 权限管理 > API 权限** 功能页，为应用开通 **创建群（im:chat:create）** API 权限，该权限是后续调用[创建群](https://open.feishu.cn/document/uAjLw4CM/ukTMukTMukTM/reference/im-v1/chat/create)接口所必须的权限。

![](https://sf3-cn.feishucdn.com/obj/open-platform-opendoc/5fbe5f067131f4e76242b8ca671bdeb7_sVtRXcpsc8.png?height=788&lazyload=true&maxWidth=600&width=1970)

4. 在应用的 **开发配置 > 事件与回调 > 事件配置** 功能页，[配置事件订阅方式](https://open.feishu.cn/document/ukTMukTMukTM/uYDNxYjL2QTM24iN0EjN/event-subscription-configure-/request-url-configuration-case)，并订阅[用户和机器人的会话首次被创建](https://open.feishu.cn/document/ukTMukTMukTM/uYDNxYjL2QTM24iN0EjN/bot-events)事件和[用户进入与机器人的会话](https://open.feishu.cn/document/uAjLw4CM/ukTMukTMukTM/reference/im-v1/chat-access_event/events/bot_p2p_chat_entered)事件。
    推荐同时订阅两个事件，你也可以根据实际场景只订阅其中一个事件。触发这两个事件中的任一一个，都可以接收到外部客户的 open_id，后续需要使用客户 open_id 拉客户进群。

![](https://sf3-cn.feishucdn.com/obj/open-platform-opendoc/72b8f92eb22bb7f27b2170f5b9a631bc_yXUHgBMWKY.png?height=874&lazyload=true&maxWidth=600&width=1962)

5. 在应用的 **应用发布 > 版本管理与发布** 功能页点击 **创建版本**。

6. 在 **版本详情** 页配置应用的版本号、能力、更新说明等信息，并开启 **对外共享**。

后续描述中，开启 **对外共享** 能力的应用机器人统称为外部机器人。

![](https://sf3-cn.feishucdn.com/obj/open-platform-opendoc/a35419d93936eb709b031841d16c8004_TfkK9qBZYi.png?height=808&lazyload=true&maxWidth=600&width=1642)

7. 在页面底部点击 **保存**，并提交应用审核。

你需要等待企业管理员审核应用，审核完成后即发布应用，以上配置才会生效。

8. 应用成功发布后，企业内的员工需要在飞书客户端内，将外部机器人分享给外部客户，并让客户点击机器人，在确认弹窗内确认后与机器人单聊。warning
    外部客户只有与外部机器人发起单聊后，外部机器人才会将该客户添加到应用的可用范围内，并触发已订阅的两个事件，通过事件可以接收到外部客户的 open_id。具体说明参见[机器人与外部用户单聊](https://open.feishu.cn/document/uAjLw4CM/ukzMukzMukzM/develop-robots/add-bot-to-external-group#4f379d44)。

**外部机器人分享方式**：在飞书客户端搜索外部机器人，复制应用链接进行分享。

![](https://sf3-cn.feishucdn.com/obj/open-platform-opendoc/4d6c6a433df4e327ac666a860436ab4b_ILGU4nCnwz.png?height=800&lazyload=true&maxWidth=600&width=2050)

9. 以外部机器人身份（tenant_access_token）调用[创建群](https://open.feishu.cn/document/uAjLw4CM/ukTMukTMukTM/reference/im-v1/chat/create) API，创建群聊。

调用接口时注意以下参数配置：

- 用户 ID 类型（`user_id_type` 参数）指定为 open_id。
    - 群主（`owner_id` 参数）必须传入企业内指定用户的 open_id。

**注意**：外部机器人创建群时不能将机器人本身设置为群主。

- 创建群时邀请的群成员（`user_id_list` 参数）需要同时传入外部客户的 open_id 和公司内部人员的 open_id。

![](https://sf3-cn.feishucdn.com/obj/open-platform-opendoc/8f7e1c4642ff7882e45d4f0fe10f373d_1644XUzJU3.png?height=710&lazyload=true&maxWidth=600&width=1415)

创建结果示例如下图，群聊内存在非本企业成员时，该群为外部群。

![](https://sf3-cn.feishucdn.com/obj/open-platform-opendoc/e55b7f06fbd552acccac24a26da71db6_5Ug2cafgFS.png?height=382&lazyload=true&maxWidth=600&width=2038)
