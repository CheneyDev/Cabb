---
title: "示例代码"
source_url: https://open.feishu.cn/document/native-integration/open-capability/protocol-components/webcontainer/sample-code
last_remote_update: 2024-11-27
last_remote_update_timestamp: 1732712011000
---
最后更新于 2024-11-27

# 示例代码
## Android

```javascript 
@com.ss.android.lark.web.WebContainerApiImpl
public class WebContainerApiImpl implements IWebContainerApi {
    private static final String TAG = "WebContainerApiImpl";
    @Override
    public void onOpen(String url, Callback callback) {
        Log.i(TAG, "onOpen url is " + url);
        Uri uri = Uri.parse(url);
        if (context != null && uri.getEncodedAuthority().equals("xxxxx")) {
            callback.onSuccess();
        } else {
            callback.onSuccess();
        }
    }
    @Override
    public void onClose(String url) {
        Log.i(TAG, "onClose url is " + url);
    }
    @Override
    public ErrorPageConfig getErrorPageConfig() {
        ErrorPageConfig errorPageConfig = new ErrorPageConfig();
        return errorPageConfig;
    }
}
```

## iOS
下面的代码提供了一个示例，拦截禁用的 url 访问

```javascript 
// LKWebContainerExternalIMP.swift
import LKWebContainerExternal // 引入要实现的 WebContainer 接口协议
import LKKABridge // 引入 KAAPI 注册类
// 自定义 KAWebContainerProtocol 实现类
@objc
public class MyWebContainer: NSObject, KAWebContainerProtocol {
    static let FORBIDDEN_CODE: Int = -1
    public func onOpen(url: String, onSuccess: @escaping () -> Void, onFail: @escaping (_ code: Int) -> Void) {       
        if isForbidden(url) {
           onFail(Self.FORBIDDEN_CODE)
        } else {
           onSuccess()
        }
    }

public func onClose(url: String) {
        print("WebContainer on close. url '(url)'")
    }

public func onTabVisibilityChanged(selected: Bool, tabParams: LKWebContainerExternal.TabParams) {
        print("WebContainer on table visibility changed. selected '(selected)', tab params (tabParams)"
    }

public func errorPageConfig() -> KAWebContainerErrorPageConfig? {
        let config = KAWebContainerErrorPageConfig()
        config.title = "ErrorPage"
        config.contentTitle = "My Web Page Error"
        config.content = "Oops! Something happend"
        config.hideBigImage = false
        return config
    }
}
func isForbidden(url: String) -> Bool {
    /* check if the url is forbidden. return false */
    return false
}
```
在 Object-C(.m) 文件代码中注册自定义的实现，load 函数会在加载 class 时执行。

方式一：直接在 OC 代码中注册
```javascript 
@import LKKABridge; // 引入 KAAPI_REGISTER 宏
@import LKWebContainerExternal;
#import <LKWebContainerExternalIMP/LKWebContainerExternalIMP-Swift.h> // 引入自定义的实现 MyWebContainer
#import "ka_auto_generated.h" // 引入 getChannel() 方法
@interface WebContainerRegistry: NSObject
@end
@implementation WebContainerRegistry
+(void)load {
    [KAAPI_REGISTER registerWithWebContainer:^id<KAWebContainerProtocol> {
        return [[MyWebContainer alloc] init];
    } cache:YES];
}
@end

```
方式二：在 OC 中调用 swift 代码注册
- .swift 文件
```javascript 
import LKKABridge
import WebContainer
@objcMembers
public class MyWebContainerLoader: NSObject {
    // 注册方法
    @objc public class func swiftLoad(channel: ID) {
        let api = KAAPI(channel: channel)
        api.register(webContainer: MyWebContainer.init, cache: true)
    }
}
```
- .m 文件
```javascript 
#import "ka_auto_generated.h" // 引入 getChannel() 方法
#import <LKWebContainerExternalIMP/LKWebContainerExternalIMP-Swift.h> // 引入 MyWebContainerLoader 所在的.swift文件
@interface WebContainerRegistry: NSObject
@end
@implementation WebContainerRegistry
+(void)load {
    NSString * channel = [NSString stringWithUTF8String:getChannel()];
    [MyWebContainerLoader swiftLoadWithChannel:channel];
}
@end
```
