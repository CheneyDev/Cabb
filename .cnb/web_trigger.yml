# .cnb/web_trigger.yml
# 复用服务选项
service_options: &service_options
  - name: server
    value: server

# 复用服务列表配置
services_list_input: &services_list_input
  description: 需要构建的服务列表
  required: true
  type: select
  multiple: true
  options: *service_options

# 日报时间范围输入（手动触发）
report_timeframe_input: &report_timeframe_input
  description: 生成日报的统计时间范围
  required: false
  type: select
  default: yesterday
  options:
    - name: 昨天
      value: yesterday
    - name: 上周
      value: last_week
    - name: 上个月
      value: last_month

branch:
  - reg: "^ma"
    buttons:
      - name: <!!!生产-开始构建!!!>
        description: 构建到生产环境
        event: web_trigger_release
        env:
          RUNNER_ARCH: cnb:arch:amd64
          ENV_URL: "https://cnb.cool/1024hub/Deploy/PlaneCabbConf/-/blob/main/env.yml"
          BRANCH: "main"
        inputs:
          SERVICES_LIST: *services_list_input
  - buttons:
      - name: <!!!测试-开始构建!!!>
        description: 构建到测试环境
        event: web_trigger_test
        env:
          RUNNER_ARCH: cnb:arch:amd64
          ENV_URL: "https://cnb.cool/1024hub/Deploy/PlaneCabbConf/-/blob/develop/env.yml"
          BRANCH: "develop"
        inputs:
          SERVICES_LIST: *services_list_input
      - name: 生成日报(进度+CodeReview)
        description: 生成包含开发进度和 Code Review 的 JSON 汇报并推送
        event: web_trigger_daily_report
        env:
          RUNNER_ARCH: cnb:arch:amd64
          ENV_URL: "https://cnb.cool/1024hub/Deploy/PlaneCabbConf/-/blob/main/env.yml"
        inputs:
          REPORT_TIMEFRAME: *report_timeframe_input
